---
phase: 02-ui-polish-ux-hardening
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - mobile/src/screens/portal/MySessionsScreen.tsx
  - mobile/src/screens/portal/MyProgressScreen.tsx
  - mobile/src/screens/portal/MyWorkoutLogScreen.tsx
  - mobile/src/screens/auth/LoginScreen.tsx
  - mobile/App.tsx
autonomous: true

must_haves:
  truths:
    - "Every client portal screen shows an error message with Retry button when a query fails"
    - "LoginScreen uses theme fontSize.xxl instead of hardcoded fontSize: 32"
    - "A NetworkBanner appears at the top of the app when the device is offline for more than 1 second"
    - "QueryClient retries are disabled when the device is offline"
  artifacts:
    - path: "mobile/src/screens/portal/MySessionsScreen.tsx"
      provides: "Error state with retry"
      contains: "onRetry"
    - path: "mobile/src/screens/portal/MyProgressScreen.tsx"
      provides: "Error state with retry"
      contains: "onRetry"
    - path: "mobile/src/screens/portal/MyWorkoutLogScreen.tsx"
      provides: "Error state with retry"
      contains: "onRetry"
    - path: "mobile/App.tsx"
      provides: "NetworkBanner integration and network-aware QueryClient"
      contains: "NetworkBanner"
  key_links:
    - from: "mobile/App.tsx"
      to: "mobile/src/components/NetworkBanner.tsx"
      via: "import and render"
      pattern: "import NetworkBanner"
    - from: "mobile/App.tsx"
      to: "@tanstack/react-query"
      via: "QueryClient retry config"
      pattern: "retry.*Network request failed"
---

<objective>
Apply shared UI components to all client portal screens (error/empty state fixes, styling standardization) and integrate the NetworkBanner into App.tsx with a network-aware QueryClient configuration.

Purpose: After this plan, client-facing screens are as polished as trainer screens, and the entire app gracefully handles offline states instead of showing cryptic errors.
Output: 4 client/auth screens updated, NetworkBanner wired into App.tsx, QueryClient configured for network awareness.
</objective>

<execution_context>
@/Users/dylanwagner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylanwagner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ui-polish-ux-hardening/02-RESEARCH.md
@.planning/phases/02-ui-polish-ux-hardening/02-01-SUMMARY.md
@mobile/src/theme.ts
@mobile/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix error states and styling on client portal screens + LoginScreen</name>
  <files>
    mobile/src/screens/portal/MySessionsScreen.tsx
    mobile/src/screens/portal/MyProgressScreen.tsx
    mobile/src/screens/portal/MyWorkoutLogScreen.tsx
    mobile/src/screens/auth/LoginScreen.tsx
  </files>
  <action>
    Read each file first, then apply changes.

    **MySessionsScreen.tsx**:
    - ADD retry button to error state (currently shows error text only, no retry)
    - Use ErrorState component: `<ErrorState message="Failed to load sessions" detail={error?.message} onRetry={refetch} />`
    - Add `isError, error, refetch` to destructured query result if not already there
    - Standardize any hardcoded shadow/borderRadius values to theme constants
    - Import ErrorState from components

    **MyProgressScreen.tsx**:
    - ADD retry button to error state
    - Use ErrorState component: `<ErrorState message="Failed to load progress" detail={error?.message} onRetry={refetch} />`
    - Standardize shadow/borderRadius values
    - Import ErrorState

    **MyWorkoutLogScreen.tsx**:
    - ADD retry button to error state
    - Use ErrorState component: `<ErrorState message="Failed to load workout logs" detail={error?.message} onRetry={refetch} />`
    - Standardize shadow/borderRadius values
    - Import ErrorState

    **LoginScreen.tsx**:
    - Replace hardcoded `fontSize: 32` with `fontSize.xxl` (which is 28 -- close enough, and consistent)
    - Fix client role button text color: if using `colors.surface` on a white background variant, switch to `colors.primary` or `colors.text` so it's visible. Read the file to understand the exact issue before changing.
    - Replace any other hardcoded colors/sizes with theme constants
    - LoginScreen already has inline error display -- this is the GOOD pattern, leave it as-is

    **Important for all screens:** Do NOT break RefreshControl. Only replace the initial loading/error blocks. Keep pull-to-refresh working via isRefetching + RefreshControl.
  </action>
  <verify>
    Run `cd /Users/dylanwagner/Projects/my-app/mobile && npx tsc --noEmit`. Grep each portal screen for "ErrorState" or "onRetry" to confirm error retry was added. Grep LoginScreen for "fontSize: 32" to confirm it was replaced.
  </verify>
  <done>
    MySessionsScreen, MyProgressScreen, MyWorkoutLogScreen all have error states with retry buttons. LoginScreen uses theme fontSize.xxl and has no hardcoded font sizes. All compile without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add NetworkBanner to App.tsx and configure network-aware QueryClient</name>
  <files>mobile/App.tsx</files>
  <action>
    1. Import NetworkBanner from `./src/components/NetworkBanner`

    2. Add NetworkBanner to the app layout. Place it INSIDE the AuthProvider (so it has access to auth context if needed) but OUTSIDE NavigationContainer. Render it right before the NavigationContainer or LoginScreen in AppContent:
       ```tsx
       // In AppContent, after the isLoading check, before returning content:
       return (
         <>
           <NetworkBanner />
           {!user ? (
             <LoginScreen />
           ) : (
             <NavigationContainer ref={navigationRef}>
               {user.role === "trainer" ? <TrainerTabs /> : <ClientTabs />}
             </NavigationContainer>
           )}
         </>
       );
       ```
       Note: You may need to wrap in a View with flex:1 or use Fragment. Make sure StatusBar still renders.

    3. Configure QueryClient to be network-aware. Replace the bare `new QueryClient()` with:
       ```tsx
       const queryClient = new QueryClient({
         defaultOptions: {
           queries: {
             retry: (failureCount, error) => {
               // Don't retry if offline (network request failed)
               if (error instanceof Error && error.message.includes('Network request failed')) return false;
               return failureCount < 2;
             },
           },
           mutations: {
             retry: false,
           },
         },
       });
       ```
       This prevents pointless retry loops when the device is offline.

    4. Do NOT move the QueryClient into a useMemo or state -- it should remain a module-level constant so it's stable across renders. This is the correct React Query pattern.
  </action>
  <verify>
    Run `cd /Users/dylanwagner/Projects/my-app/mobile && npx tsc --noEmit`. Verify NetworkBanner import exists in App.tsx. Verify QueryClient has retry configuration.
  </verify>
  <done>
    NetworkBanner renders at the top of the app (visible on all screens when offline). QueryClient is configured to stop retrying on network failures. App.tsx compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. All 3 client portal screens have ErrorState with retry
3. LoginScreen uses theme constants (no hardcoded fontSize: 32)
4. App.tsx renders NetworkBanner
5. QueryClient has network-aware retry config
</verification>

<success_criteria>
- Client portal screens have consistent error handling matching trainer screens
- LoginScreen styling uses theme tokens exclusively
- NetworkBanner is visible app-wide when device is offline (with debounce to prevent flickering)
- QueryClient stops retrying when offline
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-polish-ux-hardening/02-03-SUMMARY.md`
</output>
