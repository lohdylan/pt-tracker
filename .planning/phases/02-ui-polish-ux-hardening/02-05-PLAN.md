---
phase: 02-ui-polish-ux-hardening
plan: 05
type: execute
wave: 3
depends_on: ["02-03"]
files_modified:
  - mobile/src/screens/portal/OnboardingScreen.tsx
  - mobile/App.tsx
autonomous: false

must_haves:
  truths:
    - "A new client logging in for the first time sees a swipeable onboarding flow before reaching the tabs"
    - "The onboarding has 4 pages: Welcome, Sessions, Progress, Stay Connected"
    - "Tapping 'Get Started' on the last page sets an AsyncStorage flag and navigates to the main client tabs"
    - "A client who has already completed onboarding goes straight to tabs on next login"
    - "Onboarding is shown only to client role users, never to trainer"
  artifacts:
    - path: "mobile/src/screens/portal/OnboardingScreen.tsx"
      provides: "4-page swipeable onboarding with FlatList"
      exports: ["default"]
      min_lines: 60
    - path: "mobile/App.tsx"
      provides: "Onboarding gate for client role"
      contains: "OnboardingScreen"
  key_links:
    - from: "mobile/App.tsx"
      to: "mobile/src/screens/portal/OnboardingScreen.tsx"
      via: "import and conditional render"
      pattern: "import OnboardingScreen"
    - from: "mobile/src/screens/portal/OnboardingScreen.tsx"
      to: "@react-native-async-storage/async-storage"
      via: "read/write onboarding flag"
      pattern: "AsyncStorage.*(getItem|setItem).*onboarding"
---

<objective>
Build a 4-page client onboarding flow and integrate it into the app's navigation so first-time clients see it before reaching the tab navigator.

Purpose: New clients understand what the app offers and how to navigate it, reducing confusion on first launch. This satisfies requirement QA-05.
Output: OnboardingScreen component with 4 swipeable pages, integrated into App.tsx client flow.
</objective>

<execution_context>
@/Users/dylanwagner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylanwagner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ui-polish-ux-hardening/02-RESEARCH.md
@.planning/phases/02-ui-polish-ux-hardening/02-01-SUMMARY.md
@.planning/phases/02-ui-polish-ux-hardening/02-03-SUMMARY.md
@mobile/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OnboardingScreen and integrate into App.tsx client flow</name>
  <files>
    mobile/src/screens/portal/OnboardingScreen.tsx
    mobile/App.tsx
  </files>
  <action>
    **1. Create `mobile/src/screens/portal/OnboardingScreen.tsx`:**

    Build a FlatList-based paginated swiper with 4 pages. No external library needed.

    Props: `{ onComplete: () => void }`

    Pages (content from research):
    1. **Welcome to PT Tracker** - "Your personal training companion. Track sessions, monitor progress, and stay connected with your trainer."
       - Icon: Ionicons "fitness-outline" (size 80, colors.primary)
    2. **Your Sessions** - "View upcoming and past sessions. Get reminders before each session so you never miss one."
       - Icon: Ionicons "calendar-outline" (size 80, colors.primary)
    3. **Track Progress** - "See your measurements, workout logs, and progress photos all in one place."
       - Icon: Ionicons "trending-up-outline" (size 80, colors.primary)
    4. **Stay Connected** - "Message your trainer directly and receive notifications about new sessions and measurements."
       - Icon: Ionicons "chatbubbles-outline" (size 80, colors.primary)

    Implementation:
    - Use FlatList with `horizontal`, `pagingEnabled`, `showsHorizontalScrollIndicator={false}`
    - Each page is full screen width (use `Dimensions.get('window').width`)
    - Track current index via `onMomentumScrollEnd` (calculate from `event.nativeEvent.contentOffset.x / width`)
    - Dot indicators at bottom: map over pages, active dot is colors.primary (width 24), inactive is colors.disabled (width 8), all height 8, borderRadius full
    - Bottom button:
      - Pages 0-2: "Next" button (colors.primary background, white text, full width minus padding, borderRadius.lg, paddingVertical spacing.md)
      - Page 3: "Get Started" button (same style but slightly different text)
    - "Skip" link on pages 0-2: positioned at top-right, colors.textSecondary, fontSize.md. Tapping it calls handleComplete.
    - `handleComplete`: set AsyncStorage key `pt_onboarding_complete` to `'true'`, then call `onComplete()`
    - `handleNext`: scroll to next index via `flatListRef.current?.scrollToIndex({ index: currentIndex + 1 })`

    Styling:
    - Background: colors.background
    - Title: fontSize.xl, fontWeight '700', colors.text, textAlign center, marginTop spacing.lg
    - Subtitle: fontSize.md, colors.textSecondary, textAlign center, marginTop spacing.sm, paddingHorizontal spacing.xl, lineHeight 22
    - Icon area: centered, marginTop ~60
    - Import from theme: colors, spacing, fontSize, borderRadius

    **2. Integrate into App.tsx:**

    The onboarding gate should work like this:
    - Only applies to client role (never trainer)
    - On client login, check AsyncStorage for `pt_onboarding_complete`
    - If not complete, show OnboardingScreen instead of ClientTabs
    - When onboarding completes, set state to show ClientTabs

    In `AppContent`:
    - Add state: `const [showOnboarding, setShowOnboarding] = useState<boolean | null>(null);`
    - Add useEffect that runs when user is a client: check AsyncStorage for `pt_onboarding_complete`. If value is `'true'`, set `showOnboarding` to false. Otherwise, set to true.
    - In the render, when `user.role === 'client'`:
      - If `showOnboarding === null`: show nothing or loading (the key check is nearly instant, so this is brief)
      - If `showOnboarding === true`: render `<OnboardingScreen onComplete={() => setShowOnboarding(false)} />`
      - If `showOnboarding === false`: render `<ClientTabs />` inside NavigationContainer as before

    Import OnboardingScreen from `./src/screens/portal/OnboardingScreen`
    Import AsyncStorage from `@react-native-async-storage/async-storage`

    **Important:**
    - The NetworkBanner (added in Plan 03) should still render above the onboarding screen. Make sure OnboardingScreen is placed where ClientTabs would be, not replacing the entire AppContent return.
    - The trainer flow is unchanged -- trainer always goes straight to TrainerTabs.
    - The onboarding flag persists in AsyncStorage, so existing test users who dismiss it once will never see it again.
  </action>
  <verify>
    Run `cd /Users/dylanwagner/Projects/my-app/mobile && npx tsc --noEmit` to verify compilation. Grep App.tsx for "OnboardingScreen" and "pt_onboarding_complete" to confirm integration. Grep OnboardingScreen.tsx for "FlatList" and "pagingEnabled" to confirm swiper implementation.
  </verify>
  <done>
    OnboardingScreen renders 4 swipeable pages with icons, titles, subtitles, dot indicators, Next/Get Started buttons, and Skip link. App.tsx gates client users through onboarding on first login. Completing onboarding sets AsyncStorage flag. Subsequent logins skip onboarding. Trainer flow is unaffected. Compiles without errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete UI polish and UX hardening across the entire app:
    1. Extended theme with shadows, borderRadius, named colors
    2. 6 shared components (ScreenContainer, LoadingState, ErrorState, EmptyState, FormField, NetworkBanner)
    3. Ionicons tab icons replacing emoji
    4. Error retry buttons on all 12+ screens that were missing them
    5. Improved empty states on ConversationList and ChatScreen
    6. Network-aware error handling with offline banner
    7. Inline form validation on all 4 form screens (replacing Alert popups)
    8. 4-page client onboarding flow
  </what-built>
  <how-to-verify>
    Start the server and mobile app:
    ```
    cd server && TRAINER_PASSWORD=test123 JWT_SECRET=dev-secret-change-me npx tsx src/index.ts
    cd mobile && npx expo start
    ```

    **Trainer flow:**
    1. Log in as trainer. Verify tab icons are vector icons (not emoji).
    2. Navigate to each tab. Verify consistent styling -- no screen looks out of place.
    3. Go to Clients > pick a client > verify chevron icon (not > character).
    4. Toggle airplane mode ON. Verify a red "No internet connection" banner appears (after ~1 second). Verify tapping Retry on any error screen doesn't cause infinite loops.
    5. Toggle airplane mode OFF. Verify banner disappears.
    6. Go to Messages tab with no conversations. Verify icon + text empty state (not bare "No conversations yet").
    7. Go to Clients > Add Client. Leave first name empty, type invalid email. Tap Save. Verify inline red errors appear (not an Alert popup). Verify errors only appear on fields you touched or after submit.

    **Client flow:**
    8. Log out. Log in as a client (e.g., access code SAR101).
    9. Verify onboarding flow appears: 4 swipeable pages with icons and text.
    10. Swipe through pages. Verify dot indicators update. Tap "Get Started" on last page.
    11. Verify you land on the main client tabs.
    12. Log out and log back in as same client. Verify onboarding does NOT appear again.
    13. Check client tab icons are vector icons.
    14. Navigate to each client tab. Verify consistent error/empty states.
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe any issues that need fixing.</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. OnboardingScreen.tsx exists in mobile/src/screens/portal/
3. App.tsx imports and conditionally renders OnboardingScreen for client role
4. AsyncStorage flag `pt_onboarding_complete` is checked before showing onboarding
5. Onboarding has 4 pages with Ionicons, titles, subtitles
6. Skip and Get Started buttons both complete onboarding
</verification>

<success_criteria>
- New client sees 4-page onboarding on first login
- Onboarding is skipped on subsequent logins (AsyncStorage flag)
- Trainer never sees onboarding
- Onboarding pages are swipeable with dot indicators
- Skip link works on any page
- Get Started button works on last page
- NetworkBanner still visible above onboarding when offline
- Visual verification by human confirms professional look and feel across all screens
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-polish-ux-hardening/02-05-SUMMARY.md`
</output>
