---
phase: 02-ui-polish-ux-hardening
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - mobile/src/screens/clients/ClientFormScreen.tsx
  - mobile/src/screens/clients/MeasurementFormScreen.tsx
  - mobile/src/screens/calendar/SessionFormScreen.tsx
  - mobile/src/screens/exercises/ExerciseFormScreen.tsx
autonomous: true

must_haves:
  truths:
    - "Submitting a form with empty required fields shows red inline errors below each invalid field (not an Alert popup)"
    - "Error messages do not appear on fields the user has not yet interacted with"
    - "ClientFormScreen validates email format (basic regex) and shows error for invalid email"
    - "ExerciseFormScreen validates video URL format and shows error for invalid URLs"
    - "All form labels use the same font size, weight, and color across all 4 form screens"
  artifacts:
    - path: "mobile/src/screens/clients/ClientFormScreen.tsx"
      provides: "Inline validation for first_name, last_name, email, phone"
      contains: "FormField"
    - path: "mobile/src/screens/clients/MeasurementFormScreen.tsx"
      provides: "Inline validation for date and numeric fields"
      contains: "FormField"
    - path: "mobile/src/screens/calendar/SessionFormScreen.tsx"
      provides: "Inline validation for client, date, duration"
      contains: "FormField"
    - path: "mobile/src/screens/exercises/ExerciseFormScreen.tsx"
      provides: "Inline validation for name and video URL"
      contains: "FormField"
  key_links:
    - from: "mobile/src/screens/clients/ClientFormScreen.tsx"
      to: "mobile/src/components/FormField.tsx"
      via: "import"
      pattern: "import FormField"
    - from: "mobile/src/screens/exercises/ExerciseFormScreen.tsx"
      to: "mobile/src/components/FormField.tsx"
      via: "import"
      pattern: "import FormField"
---

<objective>
Replace Alert-based form validation with inline field-level error messages on all 4 form screens using the FormField component. Add email format and URL format validation where appropriate.

Purpose: Users see exactly which fields have problems without dismissing popups. Form styling is now consistent across all screens because FormField standardizes label appearance.
Output: 4 form screens updated with inline validation, consistent label styling, and format validators.
</objective>

<execution_context>
@/Users/dylanwagner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylanwagner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ui-polish-ux-hardening/02-RESEARCH.md
@.planning/phases/02-ui-polish-ux-hardening/02-01-SUMMARY.md
@mobile/src/components/FormField.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inline validation to ClientFormScreen and MeasurementFormScreen</name>
  <files>
    mobile/src/screens/clients/ClientFormScreen.tsx
    mobile/src/screens/clients/MeasurementFormScreen.tsx
  </files>
  <action>
    Read each file completely first to understand the current form structure, fields, and Alert-based validation.

    **Validation approach for ALL forms (apply to both tasks):**
    - Add a `touched` state object tracking which fields have been blurred: `const [touched, setTouched] = useState<Record<string, boolean>>({});`
    - Add a `submitted` boolean: `const [submitted, setSubmitted] = useState(false);`
    - Create a `validate()` function that returns an errors object `Record<string, string>` (field name -> error message)
    - Derive errors on every render: `const errors = validate();`
    - Show error for a field only if `touched[field] || submitted` (per research pitfall #2 -- never show errors on mount)
    - On submit: set `submitted = true`, check if `Object.keys(errors).length > 0`, if so return early (errors will now display). Remove the Alert.alert call.
    - Add `onBlur` handler to each FormField: `onBlur={() => setTouched(prev => ({ ...prev, [field]: true }))}`

    **ClientFormScreen.tsx:**
    1. Import FormField from `../../components/FormField`
    2. Replace all TextInput + label pairs with FormField components
    3. Add touched/submitted state and validate function
    4. Validation rules:
       - `first_name`: required ("First name is required")
       - `last_name`: required ("Last name is required")
       - `email`: if non-empty, validate format with `/^[^\s@]+@[^\s@]+\.[^\s@]+$/` ("Invalid email format"). Email is optional (not required).
       - `phone`: no validation needed (optional field)
    5. Remove Alert.alert import if no longer used elsewhere in the file
    6. Remove the old validation block that used Alert.alert
    7. Fix any styling inconsistencies: make sure all labels use FormField's built-in style (which uses colors.text, fontSize.sm, fontWeight 600)
    8. Keep the photo upload, Switch, and other non-text-input UI elements as-is

    **MeasurementFormScreen.tsx:**
    1. Import FormField from `../../components/FormField`
    2. Replace TextInput + label pairs with FormField components for text/numeric inputs
    3. Add touched/submitted state and validate function
    4. Validation rules:
       - `date`: required ("Date is required"). If non-empty, validate format loosely (just check it's not garbage -- the existing date picker might handle this)
       - Numeric fields (weight, body_fat, etc.): if non-empty, validate they parse as a number (`isNaN(parseFloat(value))` -> "Must be a valid number")
    5. Remove Alert.alert for validation
    6. Note: MeasurementFormScreen may use custom date picker or text input for date. Read the file to understand the exact field layout before making changes. Only wrap standard TextInput fields with FormField.

    **Important:** Keep all existing mutation logic, navigation, and non-form UI unchanged. Only modify the form input rendering and validation flow.
  </action>
  <verify>
    Run `cd /Users/dylanwagner/Projects/my-app/mobile && npx tsc --noEmit`. Grep ClientFormScreen.tsx for "Alert.alert" to confirm it's removed. Grep for "FormField" to confirm it's imported and used. Same for MeasurementFormScreen.tsx.
  </verify>
  <done>
    ClientFormScreen shows inline errors for empty required fields and invalid email format. MeasurementFormScreen shows inline errors for empty date and invalid numeric values. Neither screen uses Alert.alert for validation. Errors only appear after field blur or submit attempt. Both compile without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add inline validation to SessionFormScreen and ExerciseFormScreen</name>
  <files>
    mobile/src/screens/calendar/SessionFormScreen.tsx
    mobile/src/screens/exercises/ExerciseFormScreen.tsx
  </files>
  <action>
    Read each file completely first to understand current form structure.

    **SessionFormScreen.tsx:**
    1. Import FormField from `../../components/FormField`
    2. Replace TextInput + label pairs with FormField for text inputs (date, duration, notes)
    3. Add touched/submitted state and validate function
    4. Validation rules:
       - Client selection: required ("Please select a client"). Note: client selection is likely a picker, not a TextInput. Show this error as a standalone red text below the picker, styled to match FormField's error style (fontSize.sm, colors.danger).
       - `date`: required ("Date is required")
       - `duration`: required ("Duration is required"), must be a positive number ("Duration must be a positive number")
    5. Remove Alert.alert for validation
    6. Fix the label styling inconsistency: SessionFormScreen currently uses `textTransform: 'uppercase'` + `letterSpacing` on labels, which is unique among all forms. Remove these -- let FormField's standard label style apply for consistency.
    7. Keep all client picker, date picker, and other non-TextInput UI elements functioning as-is

    **ExerciseFormScreen.tsx:**
    1. Import FormField from `../../components/FormField`
    2. Replace TextInput + label pairs with FormField
    3. Add touched/submitted state and validate function
    4. Validation rules:
       - `name`: required ("Exercise name is required")
       - `video_url`: if non-empty, validate it looks like a URL with `/^https?:\/\/.+/` ("Must be a valid URL starting with http:// or https://")
       - Other fields (description, muscle groups, etc.): no validation needed
    5. Remove Alert.alert for validation
    6. Fix label color inconsistency: ExerciseFormScreen currently uses `colors.textSecondary` for labels while other forms use `colors.text`. FormField standardizes this to `colors.text` automatically.

    **For both screens:** Apply the same touched/submitted pattern described in Task 1. Errors only appear after field blur or form submit attempt.
  </action>
  <verify>
    Run `cd /Users/dylanwagner/Projects/my-app/mobile && npx tsc --noEmit`. Grep SessionFormScreen.tsx for "Alert.alert" to confirm removal. Grep for "textTransform" to confirm the uppercase label style was removed. Grep ExerciseFormScreen.tsx for "FormField" to confirm usage.
  </verify>
  <done>
    SessionFormScreen shows inline errors for missing client, empty date, and invalid duration. Label styling no longer uses uppercase/letterSpacing. ExerciseFormScreen shows inline errors for empty name and invalid video URL. Label color is consistent (colors.text via FormField). Neither uses Alert.alert for validation. Both compile without errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. No `Alert.alert` calls remain in any of the 4 form screens (for validation -- Alert may still be used for delete confirmations etc., which is fine)
3. All 4 form screens import and use FormField
4. SessionFormScreen has no `textTransform: 'uppercase'` on labels
5. ExerciseFormScreen labels use colors.text (via FormField)
6. Email regex validation works on ClientFormScreen
7. URL validation works on ExerciseFormScreen
</verification>

<success_criteria>
- All 4 form screens use FormField for text inputs with inline error display
- Validation errors appear only after field blur or submit attempt (not on mount)
- Alert.alert is not used for form validation on any screen
- Label styling is consistent across all forms (fontSize.sm, fontWeight 600, colors.text)
- Email and URL format validation catches obvious bad input
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-polish-ux-hardening/02-04-SUMMARY.md`
</output>
