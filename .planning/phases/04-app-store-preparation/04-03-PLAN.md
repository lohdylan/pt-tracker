---
phase: 04-app-store-preparation
plan: 03
type: execute
wave: 2
depends_on: ["04-02"]
files_modified:
  - mobile/assets/icon.png
  - mobile/assets/splash-icon.png
  - mobile/assets/adaptive-icon.png
autonomous: false

user_setup:
  - service: apple-developer
    why: "EAS Build requires Apple Developer Program membership for iOS code signing"
    env_vars: []
    dashboard_config:
      - task: "Enroll in Apple Developer Program ($99/year) if not already enrolled"
        location: "https://developer.apple.com/programs/enroll/"
      - task: "Have Apple ID credentials ready for eas build authentication"
        location: "Apple ID login during eas build"

must_haves:
  truths:
    - "Custom app icon PNG (1024x1024, no alpha) replaces the Expo default placeholder"
    - "Custom splash icon PNG replaces the Expo default placeholder"
    - "Running eas build --platform ios --profile production produces a signed .ipa"
  artifacts:
    - path: "mobile/assets/icon.png"
      provides: "Custom 1024x1024 app icon with no transparency"
      min_lines: 0
    - path: "mobile/assets/splash-icon.png"
      provides: "Custom splash screen icon"
      min_lines: 0
  key_links:
    - from: "mobile/app.json"
      to: "mobile/assets/icon.png"
      via: "expo.icon field"
      pattern: "icon.*icon.png"
    - from: "mobile/app.json"
      to: "mobile/assets/splash-icon.png"
      via: "expo-splash-screen plugin image field"
      pattern: "splash-icon.png"
---

<objective>
Generate custom app icon and splash icon assets, then attempt a production EAS build to produce a signed .ipa for TestFlight.

Purpose: The current icon and splash images are Expo default placeholders. They must be replaced with custom branded assets before any App Store submission. A successful production build validates that icon, splash, bundle ID, and code signing all work correctly.

Output: Custom icon.png and splash-icon.png in the assets directory. Ideally, a successful EAS production build uploaded to TestFlight.
</objective>

<execution_context>
@/Users/dylanwagner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylanwagner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-app-store-preparation/04-RESEARCH.md
@.planning/phases/04-app-store-preparation/04-02-SUMMARY.md
@mobile/app.json
@mobile/eas.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate custom app icon and splash icon assets</name>
  <files>
    mobile/assets/icon.png
    mobile/assets/splash-icon.png
    mobile/assets/adaptive-icon.png
  </files>
  <action>
    Generate programmatic app icon and splash icon using a Node.js script with the `canvas` package (or `sharp` if canvas is not available). If neither is installed, install `canvas` temporarily: `npm install canvas --no-save` in a temp directory or use `npx`.

    Alternative approach if canvas is not available: Use Python with Pillow (`pip3 install Pillow`) to generate the images.

    **Icon design (icon.png -- 1024x1024):**
    - Solid background: `#2563EB` (brand blue)
    - Large white bold letters "PT" centered in the upper portion
    - Smaller white text "TRACKER" below, also centered
    - Or alternatively: a stylized dumbbell/weight icon silhouette in white on the blue background with "PT" text
    - Keep it simple, clean, professional
    - CRITICAL: No transparency. No alpha channel. The PNG must be RGB, not RGBA. Fill the entire 1024x1024 canvas with the blue background.
    - Verify no alpha: run `python3 -c "from PIL import Image; img = Image.open('mobile/assets/icon.png'); print(img.mode)"` should print "RGB" not "RGBA"

    **Splash icon (splash-icon.png -- 1024x1024):**
    - Same design as icon but on a TRANSPARENT background (the expo-splash-screen plugin handles the background color separately via config)
    - White "PT" text (or white dumbbell + text) centered
    - This CAN have alpha channel (transparent background is expected)
    - Format: PNG with transparency

    **Adaptive icon (adaptive-icon.png -- 1024x1024):**
    - Same as icon.png (for Android, but we want consistency)
    - Can have alpha channel for Android adaptive icon foreground layer

    After generating, verify:
    - icon.png is exactly 1024x1024 and has NO alpha channel
    - splash-icon.png is exactly 1024x1024
    - adaptive-icon.png is exactly 1024x1024

    The generated icons are intended as functional placeholders. The user may replace them with professionally designed icons later, but these will pass App Store validation requirements.
  </action>
  <verify>
    1. `python3 -c "from PIL import Image; img = Image.open('mobile/assets/icon.png'); print(img.size, img.mode)"` prints `(1024, 1024) RGB`
    2. `python3 -c "from PIL import Image; img = Image.open('mobile/assets/splash-icon.png'); print(img.size, img.mode)"` prints `(1024, 1024) RGBA`
    3. `file mobile/assets/icon.png` does NOT contain "alpha" in the output
    4. `ls -la mobile/assets/icon.png mobile/assets/splash-icon.png mobile/assets/adaptive-icon.png` all exist and have reasonable file sizes (> 1KB)
  </verify>
  <done>
    Custom-branded icon.png (1024x1024 RGB, no alpha), splash-icon.png (1024x1024 RGBA), and adaptive-icon.png (1024x1024) exist in mobile/assets/, replacing the Expo default placeholders.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Custom app icon and splash icon generated programmatically with "PT" text on brand blue (#2563EB) background. The icon is 1024x1024 PNG without alpha channel (App Store requirement). The splash icon is on a transparent background (the blue background comes from the expo-splash-screen plugin config).
  </what-built>
  <how-to-verify>
    1. Open `mobile/assets/icon.png` in Preview/Finder -- should show "PT" or "PT TRACKER" in white text on a blue background, filling the entire square
    2. Open `mobile/assets/splash-icon.png` in Preview/Finder -- should show the same design but on a transparent (checkered) background
    3. If you want to test the splash screen, run a preview build: `cd mobile && eas build --platform ios --profile preview` (requires Apple Developer account)
    4. If the icons look acceptable for now (they can be replaced with professional designs later), approve to continue
    5. If you have a professionally designed icon ready, replace `mobile/assets/icon.png` and `mobile/assets/splash-icon.png` now, then approve
  </how-to-verify>
  <resume-signal>Type "approved" to continue with EAS build, or describe changes needed to the icon design</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Run EAS production build for iOS</name>
  <files></files>
  <action>
    Attempt to run a production EAS build for iOS:

    ```bash
    cd mobile && npx eas-cli build --platform ios --profile production --non-interactive
    ```

    If eas-cli is not installed globally, use `npx eas-cli` which will download and run it.

    **Expected flow:**
    1. EAS will prompt for Expo account login (if not already logged in)
    2. EAS will detect the bundle identifier from app.json (`com.pttracker.app`)
    3. EAS will generate/manage iOS distribution certificate and provisioning profile (managed credentials)
    4. EAS will upload the project and queue a cloud build
    5. Build will produce a .ipa file

    **If Apple Developer auth is needed:**
    - EAS will prompt for Apple ID and password
    - 2FA may be required
    - If the user is not enrolled in Apple Developer Program, the build will fail with an auth error
    - In that case, create a note in the summary that Apple Developer enrollment is required

    **If the build fails for bundle ID conflict:**
    - Suggest changing `bundleIdentifier` in app.json to something more unique like `com.USERNAME.pttracker`

    **If the build succeeds:**
    - Note the build URL and .ipa download link in the summary
    - Optionally submit to TestFlight: `npx eas-cli submit --platform ios --profile production`

    **If eas-cli auth fails or Apple Developer account is missing:**
    - Document the exact error
    - This is expected -- the user may need to set up their Apple Developer account
    - The config work (eas.json, app.json, assets) is still valuable even if the build can't run yet
  </action>
  <verify>
    If build succeeds: EAS dashboard shows a completed iOS production build with a downloadable .ipa
    If build fails due to auth: Error message is documented and the config files are still valid
  </verify>
  <done>
    Either a production .ipa is built and ready for TestFlight, OR the exact auth/config blocker is documented so the user can resolve it and re-run the build.
  </done>
</task>

</tasks>

<verification>
1. icon.png is 1024x1024 with no alpha channel
2. splash-icon.png is 1024x1024
3. Assets visually show branded content (not Expo default placeholders)
4. EAS build either succeeds or failure reason is documented
</verification>

<success_criteria>
- Custom icon and splash assets replace Expo defaults
- Icon passes Apple's no-alpha-channel requirement
- EAS build is attempted (success or documented failure)
- If build succeeds, .ipa exists on EAS dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/04-app-store-preparation/04-03-SUMMARY.md`
</output>
