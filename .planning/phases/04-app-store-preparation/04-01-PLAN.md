---
phase: 04-app-store-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - server/src/index.ts
  - server/public/privacy.html
  - mobile/src/screens/settings/PrivacyPolicyScreen.tsx
  - mobile/App.tsx
autonomous: true

must_haves:
  truths:
    - "Visiting /privacy on the production server returns a styled HTML page describing data collection practices"
    - "A PrivacyPolicyScreen in the app displays the privacy policy via WebView"
    - "The privacy policy is accessible from the DashboardScreen or a settings area"
  artifacts:
    - path: "server/public/privacy.html"
      provides: "Privacy policy HTML content"
      contains: "Privacy Policy"
    - path: "server/src/index.ts"
      provides: "Public /privacy route serving static HTML"
      contains: "/privacy"
    - path: "mobile/src/screens/settings/PrivacyPolicyScreen.tsx"
      provides: "WebView-based privacy policy display screen"
      contains: "WebView"
  key_links:
    - from: "mobile/src/screens/settings/PrivacyPolicyScreen.tsx"
      to: "/privacy"
      via: "WebView source URI using apiUrl from Expo config"
      pattern: "apiUrl.*privacy"
    - from: "server/src/index.ts"
      to: "server/public/privacy.html"
      via: "express.static or res.sendFile"
      pattern: "privacy"
---

<objective>
Create a privacy policy page served from the Express server and accessible in-app via a WebView screen.

Purpose: Apple requires a working privacy policy URL for App Store submission. The policy must accurately describe the data collected (contact info, health/fitness measurements, photos, push tokens, messages) and be accessible both from a URL and within the app.

Output: A `/privacy` route on the production server serving an HTML privacy policy, and a PrivacyPolicyScreen in the mobile app displaying it via WebView.
</objective>

<execution_context>
@/Users/dylanwagner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylanwagner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-app-store-preparation/04-RESEARCH.md
@server/src/index.ts
@mobile/App.tsx
@mobile/src/screens/settings/NotificationSettingsScreen.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create privacy policy HTML and serve from Express server</name>
  <files>
    server/public/privacy.html
    server/src/index.ts
  </files>
  <action>
    1. Create `server/public/` directory if it doesn't exist.
    2. Create `server/public/privacy.html` -- a self-contained, mobile-friendly HTML page with inline CSS. Content must cover:
       - App name: "PT Tracker" (or whatever is in app.json `name` field)
       - Data collected: Contact info (name, email, phone), Health & Fitness (body measurements, workout logs), Photos (progress photos), Identifiers (push notification tokens), User Content (messages), Diagnostics (crash logs via Sentry)
       - Data NOT collected: Location, financial/payment info, browsing history, third-party advertising data
       - Data is NOT sold to third parties
       - Data is NOT used for tracking or advertising
       - Data retention: stored as long as the user has an active account
       - How to request data deletion: contact the trainer directly
       - Last updated date: current date
       - Style: clean, readable, mobile-optimized (max-width 600px centered, system font stack, adequate line-height)
    3. In `server/src/index.ts`, add a public route BEFORE the `/api/auth` route that serves the privacy HTML:
       ```typescript
       // Public routes
       app.use("/privacy", express.static(path.join(__dirname, "../public")));
       ```
       Note: Since the compiled output goes to `dist/`, the path `../public` resolves correctly relative to `dist/index.js`. But for dev mode (running from `src/`), `../public` also works since `public/` is at the server root.

       Actually, use a specific sendFile for the exact file:
       ```typescript
       app.get("/privacy", (_req, res) => {
         res.sendFile(path.join(__dirname, "../public/privacy.html"));
       });
       ```
       Place this right after the `/api/health` route (both are public, no auth required).
  </action>
  <verify>
    Start the server locally and run: `curl http://localhost:3000/privacy` -- should return the full HTML page with privacy policy content. Check that the response includes "Privacy Policy" in the content and returns a 200 status.
  </verify>
  <done>
    The `/privacy` endpoint returns a styled HTML privacy policy page covering all data types collected by the app. No authentication required.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PrivacyPolicyScreen and wire into navigation</name>
  <files>
    mobile/src/screens/settings/PrivacyPolicyScreen.tsx
    mobile/App.tsx
  </files>
  <action>
    1. Create `mobile/src/screens/settings/PrivacyPolicyScreen.tsx`:
       - Import WebView from `react-native-webview` (already installed, v13.15.0)
       - Import Constants from `expo-constants`
       - Get API_URL from `Constants.expoConfig?.extra?.apiUrl || "http://localhost:3000"`
       - Render a full-screen WebView with `source={{ uri: \`\${API_URL}/privacy\` }}`
       - Add a loading indicator while WebView loads (use `onLoadStart`/`onLoadEnd` or `startInLoadingState` prop)
       - Style: `flex: 1` on the WebView

    2. In `mobile/App.tsx`:
       - Import PrivacyPolicyScreen
       - Add "PrivacyPolicy" to the HomeStackParams type (for trainer) -- `PrivacyPolicy: undefined`
       - Add a `<HomeStack.Screen name="PrivacyPolicy" component={PrivacyPolicyScreen} options={{ title: "Privacy Policy" }} />` in the HomeStack navigator
       - Also add "PrivacyPolicy" to the client portal stack params so clients can access it too
       - Add corresponding Stack.Screen in the client navigator

    3. Add a way to navigate to the privacy policy:
       - In DashboardScreen (trainer home), add a small "Privacy Policy" link/button at the bottom (subtle, like a text link in the footer area)
       - OR, if there's a settings/profile area, add it there. The NotificationSettingsScreen is accessed from DashboardScreen, so follow that same pattern -- add a "Privacy Policy" row near the notification settings button on the dashboard.
       - For clients, add a similar link in MyProgressScreen or wherever settings are accessible.
  </action>
  <verify>
    In the mobile app, navigate to the Privacy Policy screen from the dashboard. Verify the WebView loads the privacy policy HTML from the server. The screen title should show "Privacy Policy" in the navigation header.
  </verify>
  <done>
    Both trainer and client users can access the privacy policy from within the app. The WebView displays the server-hosted privacy policy page.
  </done>
</task>

</tasks>

<verification>
1. `curl https://pt-tracker-production-353a.up.railway.app/privacy` returns 200 with HTML content (after deployment)
2. In the mobile app, tap "Privacy Policy" from the trainer dashboard -- WebView loads the policy
3. In the mobile app as a client, access the privacy policy screen -- WebView loads the policy
4. The privacy policy HTML is mobile-friendly and readable on an iPhone screen
</verification>

<success_criteria>
- Privacy policy is accessible at `/privacy` on the server without authentication
- Privacy policy covers all data types: contact info, health/fitness, photos, push tokens, messages, diagnostics
- In-app PrivacyPolicyScreen displays the policy via WebView
- Both trainer and client roles can navigate to the privacy policy screen
</success_criteria>

<output>
After completion, create `.planning/phases/04-app-store-preparation/04-01-SUMMARY.md`
</output>
