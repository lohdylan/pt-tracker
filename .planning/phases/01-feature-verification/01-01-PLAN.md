---
phase: 01-feature-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mobile/src/api.ts
  - mobile/src/screens/workouts/WorkoutLogScreen.tsx
autonomous: false

must_haves:
  truths:
    - "DEV_HOST IP in api.ts matches the developer's current LAN IP"
    - "Server is reachable from the mobile app on the physical device"
    - "Trainer can add exercises with search, enter set details (weight/reps), add notes, and save workout logs"
    - "Saved workout logs appear in the Saved Logs section after saving"
    - "Saved logs persist after force-closing and reopening the app"
    - "Trainer can edit, delete, and reorder saved workout logs"
    - "Applying a workout template populates exercise rows with correct set counts"
    - "Rest Timer counts down and plays an alarm sound"
  artifacts:
    - path: "mobile/src/api.ts"
      provides: "Correct DEV_HOST IP for local network"
      contains: "DEV_HOST"
    - path: "mobile/src/screens/workouts/WorkoutLogScreen.tsx"
      provides: "Workout logging UI"
      min_lines: 400
  key_links:
    - from: "mobile/src/screens/workouts/WorkoutLogScreen.tsx"
      to: "/api/sessions/:sessionId/logs"
      via: "useBatchCreateWorkoutLogs hook"
      pattern: "useBatchCreateWorkoutLogs"
    - from: "mobile/src/components/ExercisePicker.tsx"
      to: "/api/exercises/search"
      via: "useExerciseSearch hook"
      pattern: "useExerciseSearch"
---

<objective>
Fix the hardcoded DEV_HOST IP address for local network connectivity, then verify workout logging UX works end-to-end on a physical iOS device. Fix any bugs encountered during device testing.

Purpose: The workout logging feature is the most complex of the 4 new features (exercise picker, set detail editor, rest timer, batch save, reorder, templates). It must work correctly before moving to the other features. The IP fix is a prerequisite for ALL features to work.
Output: Updated api.ts with correct IP, any bug fixes in workout logging screens/hooks, and human verification that the feature works on device.
</objective>

<execution_context>
@/Users/dylanwagner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylanwagner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-feature-verification/01-RESEARCH.md
@mobile/src/api.ts
@mobile/src/screens/workouts/WorkoutLogScreen.tsx
@mobile/src/components/ExercisePicker.tsx
@mobile/src/components/SetDetailEditor.tsx
@mobile/src/components/RestTimer.tsx
@mobile/src/hooks/useWorkoutLogs.ts
@mobile/src/hooks/useExercises.ts
@mobile/src/hooks/useTemplates.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix DEV_HOST IP and verify server connectivity</name>
  <files>mobile/src/api.ts</files>
  <action>
1. Run `ifconfig en0 | grep "inet " | awk '{print $2}'` to get the current Mac LAN IP address.
2. Open `mobile/src/api.ts` and update the `DEV_HOST` constant on line 4 from `"192.168.1.68"` to the current IP.
3. Start the server: `cd server && TRAINER_PASSWORD=test123 JWT_SECRET=dev-secret-change-me npx tsx src/index.ts` (run in background or instruct user).
4. Verify connectivity: `curl http://<NEW_IP>:3000/api/auth/trainer-login -H "Content-Type: application/json" -d '{"password":"test123"}'` -- should return a JSON object with a token field.
5. If the server is not running, note that the user must start it before testing.

This IP fix is shared across ALL features -- workout logging, photos, messaging, and notifications all depend on the correct IP.
  </action>
  <verify>
- `curl http://<NEW_IP>:3000/api/auth/trainer-login -H "Content-Type: application/json" -d '{"password":"test123"}'` returns 200 with token
- `grep DEV_HOST mobile/src/api.ts` shows the updated IP address
  </verify>
  <done>DEV_HOST in api.ts matches the current Mac LAN IP, and the server responds to API requests at that IP.</done>
</task>

<task type="auto">
  <name>Task 2: Review and fix workout logging code for device readiness</name>
  <files>mobile/src/screens/workouts/WorkoutLogScreen.tsx</files>
  <action>
Review the WorkoutLogScreen, ExercisePicker, SetDetailEditor, RestTimer, and related hooks for potential runtime issues. The code review from research found no critical bugs in workout logging, but do a final check:

1. Verify ExercisePicker's search debounce works (2+ char trigger). Check `useExerciseSearch` hook calls the correct endpoint (`/api/exercises/search?q=...`).
2. Verify SetDetailEditor properly handles number input (weight/reps). Check that keyboard type is "numeric" or "decimal-pad".
3. Verify RestTimer audio loads from external URL (`https://actions.google.com/sounds/v1/alarms/beep_short.ogg`). The catch block handles failure silently -- this is acceptable for now.
4. Verify batch save payload matches server expectations: the `useBatchCreateWorkoutLogs` hook should POST to `/sessions/:sessionId/logs/batch` with an array of log objects.
5. Check that existing logs load correctly from `useWorkoutLogs(sessionId)`.
6. Ensure the workout log screen is accessible via the navigation path: Clients > Client Detail > Session Detail > "Log Workout" button.

If any issues are found, fix them. If code looks correct, note that in the summary. The primary validation will happen during the human-verify checkpoint.
  </action>
  <verify>
- No TypeScript compilation errors: `cd mobile && npx tsc --noEmit 2>&1 | grep -i "WorkoutLog\|ExercisePicker\|SetDetail\|RestTimer" || echo "No errors found"`
- Hooks reference correct API paths
  </verify>
  <done>Workout logging code reviewed, any found issues fixed, ready for on-device testing.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed DEV_HOST IP for network connectivity. Reviewed and (if needed) fixed workout logging code for device readiness.</what-built>
  <how-to-verify>
Start both server and mobile app:
- Terminal 1: `cd server && TRAINER_PASSWORD=test123 JWT_SECRET=dev-secret-change-me npx tsx src/index.ts`
- Terminal 2: `cd mobile && npx expo start` (scan QR with Expo Go on iPhone)

Test as trainer (login with password: test123):
1. Navigate to Clients tab > select a client > select a session > tap "Log Workout"
2. Type 2+ characters in exercise picker -- verify search results appear
3. Select an exercise, enter weight and reps for a set, tap the completed checkbox
4. Tap "+ Add Set" to add more sets
5. Add notes to the exercise
6. Tap "+ Add Exercise" to add a second exercise
7. Tap "Save All" -- verify success alert appears
8. Go back and return to the same session's workout log -- verify saved logs appear in "Saved Logs" section
9. Tap "Edit" on a saved log, change a value, tap "Save" -- verify it updates
10. Tap "Delete" on a saved log -- verify it's removed
11. Use up/down arrows to reorder saved logs
12. Tap "Apply Template" (if templates exist) -- verify exercises populate
13. Expand Rest Timer, set a duration, start it, verify countdown works
14. Force-close the app and reopen -- verify saved logs persist

If any step fails, describe what happened. Claude will fix the issue and re-present for verification.
  </how-to-verify>
  <resume-signal>Type "approved" if all steps pass, or describe any failures for Claude to fix.</resume-signal>
</task>

</tasks>

<verification>
- DEV_HOST IP matches current LAN IP (verified via ifconfig)
- Server responds at new IP on port 3000
- TypeScript compiles without errors related to workout logging files
- Human verified all workout logging flows on physical iOS device
</verification>

<success_criteria>
Trainer can create workout logs with exercise selection, set details (weight/reps), and notes. Saved logs persist after app restart. Edit, delete, and reorder all work. Templates can be applied. Rest timer functions.
</success_criteria>

<output>
After completion, create `.planning/phases/01-feature-verification/01-01-SUMMARY.md`
</output>
